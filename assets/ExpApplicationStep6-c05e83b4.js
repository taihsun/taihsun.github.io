import{g as L,S as I}from"./SampleCategory-297f54b4.js";import{_ as T,a as M}from"./ExpApplicationStep6NonLivingFormPreview.vue_vue_type_script_setup_true_lang-8a75d879.js";import{d as N,A as F,B as V,r as z,g as G,h as S,o as n,c as l,H as y,w as B,G as j,a as t,F as $,C as w,t as e,l as p,n as O,D as v,a0 as R,a1 as W,j as E,al as q,am as H,an as U}from"./index-bc038c8e.js";import{a as J}from"./ProjectSource-b760b0a5.js";import"./SelectedIhcCommissionedItemPanel-3517db15.js";import"./LocationService-21239143.js";import"./LocationDbSimulator-d223c353.js";const K={class:"vstack"},Q={class:"p-2"},X={class:"col-2 my-1"},Y={class:"mx-2"},Z={class:"col-2 my-1"},tt={class:"mx-2"},et={class:"col-2 my-1"},st={class:"mx-2"},ot={class:"col-2 my-1"},nt={class:"mx-2"},lt={class:"d-flex flex-row justify-content-end"},at={class:"p-2"},ct={class:"d-flex flex-column"},it={class:"p-2"},dt=t("b",null,"實驗總費用",-1),rt={class:"badge text-bg-info"},pt={key:1,class:"table table-bordered caption-top"},ut=t("caption",null," 計畫資訊 ",-1),_t=t("td",null,"計畫主持人帳號",-1),mt=t("td",null,"計畫共同負責人帳號",-1),ht=t("td",null,"主要聯絡人帳號",-1),vt=t("td",null,"主要聯絡人電話",-1),ft=t("td",null,"計畫編號",-1),gt=t("td",null,"計畫名稱",-1),bt=t("td",null,"計畫核銷機構(收據抬頭)",-1),jt=t("td",null,"計畫所屬部門",-1),yt=t("td",null,"產學合作",-1),$t=t("td",null,"計畫經費來源",-1),Ct=t("td",null,"計畫描述",-1),xt=t("td",null,"有無計畫執行期限",-1),St=N({inheritAttrs:!1,__name:"ExpApplicationStep6ProjectBalanceDeduction",props:{id:{},projectBalanceDeductions:{default:()=>[]},project:{}},async setup(d){let r,u;const f=F(),a=d,o=a.id,g=([r,u]=V(()=>f.fetchTotalExpCaseAmounts(o)),r=await r,u(),r),c=z(a.projectBalanceDeductions),_=G(()=>c.value?c.value.reduce((s,b)=>s+b.balance,0):0);return(s,b)=>{const m=S("AppBlock");return n(),l("div",R(W(s.$attrs)),[s.projectBalanceDeductions.length!==0?(n(),y(m,{key:0,id:"balanceDeductionBlock",class:"my-1"},{header:B(()=>[j("餘額扣除計畫 ")]),content:B(()=>[t("div",K,[t("div",Q,[(n(!0),l($,null,w(s.projectBalanceDeductions,i=>(n(),l("div",{class:"row",key:i.tacProjectId},[t("div",X,[t("span",Y,e(i.tacProjectId),1)]),t("div",Z,[t("span",tt,e(i.pi),1)]),t("div",et,[t("span",st,e(i.organization),1)]),t("div",ot,[t("span",nt,e(i.balance)+"元",1)])]))),128))])]),t("div",lt,[t("div",at,[t("div",ct,[t("div",it,[dt,j(": "),t("span",rt,e(p(g)),1),j(" 元, 扣除金額: "),t("span",{class:O(["badge text-bg-success",{"text-bg-danger":p(g)>_.value}])},e(_.value),3),j(" 元 ")])])])])]),_:1})):v("",!0),s.project?(n(),l("table",pt,[ut,t("tbody",null,[t("tr",null,[_t,t("td",null,e(s.project.piEmail),1)]),t("tr",null,[mt,t("td",null,e(s.project.coPiEmail),1)]),t("tr",null,[ht,t("td",null,e(s.project.contactEmail),1)]),t("tr",null,[vt,t("td",null,e(s.project.contactPhone),1)]),t("tr",null,[ft,t("td",null,e(s.project.code),1)]),t("tr",null,[gt,t("td",null,e(s.project.name),1)]),t("tr",null,[bt,t("td",null,e(s.project.organization),1)]),t("tr",null,[jt,t("td",null,e(s.project.department),1)]),t("tr",null,[yt,t("td",null,e(s.project.cooperate==="yes"?"是":"否"),1)]),t("tr",null,[$t,t("td",null,e(p(J)(s.project.projectSource)),1)]),t("tr",null,[Ct,t("td",null,e(s.project.description),1)]),t("tr",null,[xt,t("td",null,e(s.project.deadline==="yes"?`${s.project.executionPeriodFrom} ~ ${s.project.executionPeriodTo}`:"無"),1)])])])):v("",!0)],16)}}}),C=d=>(q("data-v-c550c709"),d=d(),H(),d),Bt=C(()=>t("h4",{class:"fw-bold py-3 mb-4"},"預覽",-1)),wt={class:"row"},Dt={class:"mb-4 mb-xl-0"},kt={class:"mt-3"},At={class:"row"},Pt={class:"col-12 mb-3 mb-md-0"},It={class:"list-group list-group-horizontal-md"},Et=C(()=>t("a",{class:"list-group-item list-group-item-action active",id:"exp-service-item-list","data-bs-toggle":"list",href:"#exp-service-item"},"服務項目",-1)),Nt={class:"list-group-item list-group-item-action",id:"application-form-list","data-bs-toggle":"list",href:"#application-form"},Ft=C(()=>t("a",{class:"list-group-item list-group-item-action",id:"deduction-list","data-bs-toggle":"list",href:"#deduction"},"扣款計畫",-1)),Vt={class:"col-12"},zt={class:"tab-content p-0 font"},Lt={class:"tab-pane fade show active",id:"exp-service-item"},Tt={class:"row"},Mt={class:"card"},Gt={class:"card-body"},Ot={class:"mb-4"},Rt={class:"mb-4"},Wt={class:"table table-sm my-1"},qt=C(()=>t("thead",null,[t("tr",null,[t("th",null,"Number"),t("th",null,"Service Items"),t("th",null,"Sample amount"),t("th",null,"Comment")])],-1)),Ht={class:"tab-pane fade",id:"application-form"},Ut={class:"tab-pane fade",id:"deduction"},Jt={class:"mb-2 d-flex justify-content-between flex-row-reverse mt-2"},Kt=N({__name:"ExpApplicationStep6",props:{id:{}},async setup(d){let r,u;const f=d,a=F(),o=z();[r,u]=V(()=>a.loadDataForStep6(f.id).then(c=>{o.value=c}).catch(()=>{a.toMainWithMessage("資料載入失敗")})),await r,u();const g=async()=>{a.applyExpCaseApplication(f.id).then(c=>{a.toMainWithMessage(`實驗申請已送出，Service Request ID: ${c}`)})};return(c,_)=>{const s=S("AppCard"),b=S("AppConfirmButton");return n(),l($,null,[Bt,E(s,null,{body:B(()=>{var m,i,D,k,A,P;return[t("div",wt,[t("div",Dt,[t("div",kt,[t("div",At,[t("div",Pt,[t("div",It,[Et,t("a",Nt,e(p(L)(o.value.sampleCategory))+"表單 ",1),Ft])]),t("div",Vt,[t("div",zt,[t("div",Lt,[t("div",Tt,[t("div",Mt,[t("div",Gt,[t("div",Ot," 已安排之實驗日期區間: "+e(o.value.expDateStart)+" ~ "+e(o.value.expDateEnd),1),t("div",Rt,"TAC聯絡窗口/SD: "+e(o.value.liaison),1),t("table",Wt,[qt,t("tbody",null,[(n(!0),l($,null,w((m=o.value)==null?void 0:m.expServiceItems,h=>(n(),l("tr",{key:h.id},[t("td",null,e(h.code),1),t("td",null,e(h.name),1),t("td",null,[(n(!0),l($,null,w(h.expServiceItemUnits,x=>(n(),l("span",{key:x.id},e(`${x.amount} (${x.name})`),1))),128))]),t("td",null,e(h.comment),1)]))),128))])])])])])]),t("div",Ht,[((i=o.value)==null?void 0:i.sampleCategory)===p(I).LIVING&&o.value.livingFormsPreview?(n(),y(T,{key:0,class:"font",livingForms:o.value.livingFormsPreview},null,8,["livingForms"])):v("",!0),((D=o.value)==null?void 0:D.sampleCategory)===p(I).NON_LIVING&&o.value.nonLivingFormPreview?(n(),y(M,{key:1,class:"font",form:o.value.nonLivingFormPreview},null,8,["form"])):v("",!0)]),t("div",Ut,[(k=o.value)!=null&&k.projectBalanceDeductions?(n(),y(St,{key:0,class:"font",id:"props.id",projectBalanceDeductions:(A=o.value)==null?void 0:A.projectBalanceDeductions,project:(P=o.value)==null?void 0:P.deductionProject},null,8,["projectBalanceDeductions","project"])):v("",!0)])])])])])])])]}),_:1}),t("div",Jt,[E(b,{text:"送出",handler:g}),t("button",{class:"btn btn-outline-secondary",onClick:_[0]||(_[0]=m=>p(a).proceedToStep4(c.id))}," 回上一步 ")])],64)}}});const oe=U(Kt,[["__scopeId","data-v-c550c709"]]);export{oe as default};
