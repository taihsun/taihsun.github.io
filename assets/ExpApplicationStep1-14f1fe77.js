import{U as Q}from"./UserService-f1f028bb.js";import{d as W,M as X,Q as Y,y as q,R as J,r as C,H as P,S as Z,a as ee,T as te,z as se,c as ae,U as ne,e as D,o,f as u,h as r,g as e,t as h,D as V,w as c,n as I,j as l,C as oe,V as v,B as $,F as g,A as B,W as re,l as le,X as ce,Y as ie}from"./index-040fc8c0.js";import{T as me,A as ue}from"./formSchema-b60d08e0.js";import"./ProjectChargeType-415a59f1.js";var T=(s=>(s.NA="NA",s.STAGE_1="STAGE1",s.STAGE_2="STAGE2",s.STAGE_3="STAGE3",s.STAGE_4="STAGE4",s.STAGE_5="STAGE5",s.STAGE_6="STAGE6",s))(T||{});const R=T;(s=>{function p(){return["NA","STAGE1","STAGE2","STAGE3","STAGE4","STAGE5","STAGE6"]}s.getDrugScreenings=p;function y(f){switch(f){case"NA":return"不適用";case"STAGE1":return"stage 1. 篩選、鑑定及確認:生物標的、分子標靶新藥、新生醫材料、新檢測試劑";case"STAGE2":return"stage 2. 潛力標的物之合成及改良:新醫材/試劑之設計/改良";case"STAGE3":return"stage 3. 臨床檢體驗證、細胞及動物有效性評估";case"STAGE4":return"stage 4. 先導藥品及醫材之最適化; 新醫材/試劑產品雛型之開發及試製造";case"STAGE5":return"stage 5. 藥理藥動改良;劑型設計;毒理安全性試驗";case"STAGE6":return"stage 6. 試驗用藥物: 新醫材/試劑之申請";default:return""}}s.getChineseDescription=y;function d(f){switch(f){case"NA":return"不適用";case"STAGE1":return"stage 1. Identification & confirmation of biomarkers, new targets, drugs, bio-medical devices.";case"STAGE2":return"stage 2. Synthesis & improvement of targets. Design & modification of new medical devices.";case"STAGE3":return"stage 3. Validation with clinical samples. In vitro & in vivo efficacy evaluation.";case"STAGE4":return"stage 4. Optimization of leads & device models-Prototype development- Pilot-scale manufacturing.";case"STAGE5":return"stage 5. Improvement of PK, PD, & formulation- Animal toxicity and safety tests.";case"STAGE6":return"stage 6. IND/IDE applications.";default:return""}}s.getEnglishDescription=d})(T||(T={}));const pe={class:"fw-bold py-3 mb-4"},de={class:"row mb-3"},_e=e("label",{for:"expDateStart",class:"col-sm-2 col-md-3 col-form-label red-star"},"已安排之實驗日期區間",-1),he={class:"col-8"},fe={class:"d-flex flow-row gap-1"},Se={class:"row mb-3"},ye=e("label",{for:"liaison",class:"col-sm-2 col-md-3 col-form-label red-star"},"TAC聯絡窗口/SD",-1),be={class:"col-8"},ve=e("h5",{class:"mb-0"},"已選擇服務項目",-1),ge={class:"table-responsive"},Te={class:"table table-striped"},Ae=e("thead",null,[e("tr",null,[e("th",null,"Number"),e("th",null,"Service item"),e("th",null,"Note"),e("th",null,"Sample amount"),e("th",null,"Comment")])],-1),Ee={class:"input-group mb-3"},Ge=e("h5",{class:"mb-0 red-star"},"Survey for Drug Screening",-1),xe=e("span",{class:"fw-light"}," Is this experiment related to drug screening or development?",-1),ke=e("h5",{class:"mb-0 red-star"},"Points for Attention",-1),we=e("ol",null,[e("li",null,[e("a",{class:"link-primary",href:"https://tmc.sinica.edu.tw/sampleprep_c.html",target:"_blank"},"血液、血清、組織及尿液/Blood, Serum, Tissue and Urine")]),e("li",null,[e("a",{class:"link-primary",href:"https://tmc.sinica.edu.tw/slide_c.html",target:"_blank"},"玻片掃描/Slide Scanning")]),e("li",null,[e("a",{class:"link-primary",href:"https://tmc.sinica.edu.tw/femur_c.html",target:"_blank"},"股骨製備/Femur Preparation")]),e("li",null,[e("a",{class:"link-primary",href:" https://tmc.sinica.edu.tw/animal_checkin_c_01.html",target:"_blank"},"動物房/Mouse Hotel ")])],-1),Ce={class:"form-check form-check-inline"},De={class:"form-check-label",for:"terms"},Ie=e("div",{class:"mb-2 d-flex justify-content-between flex-row-reverse"},[e("button",{class:"btn btn-primary"},"確定申請")],-1),Pe=W({__name:"ExpApplicationStep1",props:{labType:{}},async setup(s){let p,y;const d=s,f=le(),_=X(),L=Y(),M=q(),j=Q.getInstance();J(L);const i=C(_.getCartByLabType(d.labType)),A=t=>t==="TMC"?me:ue,E=C(A(d.labType));P(()=>{console.log("onBeforeMount");const t=d.labType;i.value=_.getCartByLabType(t),E.value=A(t)}),Z((t,S)=>{console.log("onBeforeRouteUpdate");const n=t.params.labType;i.value=_.getCartByLabType(n),E.value=A(n)});const z=i.value.items.map(t=>({code:t.code,name:t.name,note:t.note,expServiceItemUnits:t.expServiceItemUnits})),{errors:G,handleSubmit:H}=ee({initialValues:{expServiceItems:z}}),{fields:K}=te("expServiceItems"),b=C(""),O=([p,y]=se(()=>j.fetchExpTeamMembers(i.value.labType).catch(t=>(b.value=t.message,[]))),p=await p,y(),p).map(t=>({id:t.id,name:t.title,value:t.id.toString()})),N=ae(()=>d.labType==="TMC"),U=H((t,S)=>{try{E.value.validateSync(t,{abortEarly:!1}),M.processStep1(i.value.labType,t,"1").then(async n=>{try{_.reset(i.value.labType),await M.proceedToStep2(n)}catch(m){b.value=m.message}}).catch(n=>{b.value=n.message})}catch(n){n.inner.map(m=>{let x={[m.path]:m.message};S.setErrors(x)})}}),F=()=>{f.push("/main")};return P(()=>{_.isEmpty&&F()}),ne(()=>{_.isEmpty&&F()}),(t,S)=>{const n=D("AppFloatingMessage"),m=D("AppInputGroup"),x=D("AppSelect");return o(),u(g,null,[r(n,{message:b.value},null,8,["message"]),e("form",{onSubmit:S[0]||(S[0]=(...a)=>l(U)&&l(U)(...a))},[e("h4",pe,h(i.value.labType)+"服務項目",1),N.value?(o(),V(v,{key:0,class:"mb-2"},{body:c(()=>[e("div",de,[_e,e("div",he,[e("div",fe,[r(m,{label:"起",id:"expDateStart",type:"date",format:"yyyy-mm-dd",name:"expDateStart",class:I(l(G).expDateStart?"form-control is-invalid":"form-control")},null,8,["class"]),oe("~ "),r(m,{label:"迄",id:"expDateEnd",type:"date",format:"yyyy-mm-dd",name:"expDateEnd",class:I(l(G).expDateEnd?"form-control is-invalid":"form-control")},null,8,["class"])])])]),e("div",Se,[ye,e("div",be,[r(x,{id:"liaison",name:"liaison",options:l(O),"default-option":!0},null,8,["options"])])])]),_:1})):$("",!0),r(v,{class:"mb-2"},{header:c(()=>[ve]),body:c(()=>[e("div",ge,[e("table",Te,[Ae,e("tbody",null,[(o(!0),u(g,null,B(l(K),(a,k)=>(o(),u("tr",{key:a.key},[e("td",null,h(a.value.code),1),e("td",null,h(a.value.name),1),e("td",null,h(a.value.note),1),e("td",null,[(o(!0),u(g,null,B(a.value.expServiceItemUnits,w=>(o(),u("div",{key:w.index},[e("div",Ee,h(w.amount)+" "+h(w.name),1)]))),128))]),e("td",null,[r(ce,{name:`expServiceItems[${k}].comment`},null,8,["name"])])]))),128))])])])]),_:1}),r(v,{class:"mb-2"},{header:c(()=>[Ge]),title:c(()=>[xe]),body:c(()=>[(o(!0),u(g,null,B(l(R).getDrugScreenings(),(a,k)=>(o(),u("div",{class:"form-check my-3",key:a},[r(ie,{id:`stage${k}`,name:"drugScreening",label:l(R).getChineseDescription(a),"checked-value":a},null,8,["id","label","checked-value"])]))),128))]),_:1}),N.value?(o(),V(v,{key:1,class:"mb-2"},{header:c(()=>[ke]),body:c(()=>[e("div",null,[we,e("div",Ce,[r(re,{id:"terms",name:"terms","checked-value":"agree"}),e("label",De,[e("span",{class:I(l(G).terms?"text-danger":"")}," 我已詳細閱讀注意事項 (I have read the notes for applicants)",2)])])])]),_:1})):$("",!0),Ie],32)],64)}}});export{Pe as default};
