import{d as E,o as t,c as l,a as e,F as p,y,t as n,n as D,D as V,e as N,O as M,r as R,s as j,h as v,z as T,j as m,w as S,A as F,l as C,B as L,X as Z,K as U}from"./index-668b5f53.js";import{w as q,b as G}from"./ExpCaseFormSchema-8e308c1c.js";import"./formSchema-b94cdea0.js";const H={class:"table-responsive"},J={class:"table table-bordered"},Q=e("thead",{class:"table-dark"},[e("tr",null,[e("td",null,"Number"),e("td",null,"Service Item"),e("td",null,"Applied Amount"),e("td",null,"Comment"),e("td",null,"實驗人員"),e("td",null,"Received Sample Amount"),e("td",null,"Received Comment"),e("td",null,"Completed Amount"),e("td",null,"Completed Comment"),e("td",null,"開始日期"),e("td",null,"完成日期"),e("td",null,"操作人員")])],-1),Y=E({__name:"CompletedEditZone",props:{items:{}},setup(w){return(h,A)=>(t(),l("div",H,[e("table",J,[Q,e("tbody",null,[(t(!0),l(p,null,y(h.items,(a,g)=>(t(),l("tr",{key:a.code},[e("td",null,n(a.code),1),e("td",null,n(a.name),1),e("td",null,[(t(!0),l(p,null,y(a.units,s=>(t(),l("div",{key:s.id},n(s.amount)+" "+n(s.name),1))),128))]),e("td",null,n(a.comment),1),e("td",null,n(a.experimenter),1),e("td",null,[(t(!0),l(p,null,y(a.receivedUnits,(s,_)=>(t(),l("div",{key:s.id},[e("span",{class:D({"text-danger":a.units[_].amount>s.amount})},n(s.amount)+" "+n(s.name),3)]))),128))]),e("td",null,[e("span",null,n(h.items[g].receivedComment),1)]),e("td",null,[(t(!0),l(p,null,y(a.completedUnits,(s,_)=>(t(),l("div",{key:s.id},[e("span",{class:D({"text-danger":a.receivedUnits[_].amount>s.amount})},n(s.amount)+" "+n(s.name),3)]))),128))]),e("td",null,[e("span",null,n(h.items[g].completedComment),1)]),e("td",null,n(a.startingDate),1),e("td",null,n(a.completionDate),1),e("td",null,n(a.operator),1)]))),128))])])]))}}),ee={key:0,id:"uploadedFileBlock",class:"table-responsive my-1"},te={class:"table table-bordered caption-top"},ne=e("caption",null," 已上傳檔案列表 ",-1),le=e("thead",null,[e("tr",null,[e("td",null,"上傳日期"),e("td",null,"上傳人員"),e("td",null,"備註"),e("td",null,"檔案"),e("td")])],-1),oe={id:"uploadFileBlock"},se={class:"d-flex"},ae={class:"p-1"},ue={class:"p-1"},de={class:"ms-auto p-2"},ie=E({__name:"UploadResultFileEditZone",props:{id:{}},async setup(w){let h,A;const a=w,g=V(),s=U.getInstance(),{handleSubmit:_,values:$}=N({}),{fields:f,push:d,remove:r}=M("files"),u=R([]);[h,A]=j(()=>s.fetchUploadedResultFiles(a.id).then(o=>{u.value=o})),await h,A();const b=_(async o=>{var i;((i=o.files)==null?void 0:i.length)>0&&await s.uploadResultFiles(a.id,o.files).then(()=>{g.reload()})}),x=o=>{s.deleteResultFile(o.id).then(()=>{g.reload()})};return(o,i)=>{var W;const c=v("AppDownloadLink"),I=v("AppTrashButton"),z=v("AppFileInput"),P=v("AppTextarea"),K=v("AppMinusButton"),O=v("AppPlusButton"),X=v("AppCard");return t(),l(p,null,[(W=u.value)!=null&&W.length?(t(),l("div",ee,[e("table",te,[ne,le,e("tbody",null,[(t(!0),l(p,null,y(u.value,(k,B)=>(t(),l("tr",{key:B},[e("td",null,n(k.uploadedDate),1),e("td",null,n(k.uploader),1),e("td",null,n(k.comment),1),e("td",null,[m(c,{name:k.name,value:k.value},null,8,["name","value"])]),e("td",null,[m(I,{onClick:Ve=>x(k)},null,8,["onClick"])])]))),128))])])])):T("",!0),m(X,null,{header:S(()=>[F(" 新增上傳檔案 ")]),body:S(()=>[e("div",oe,[(t(!0),l(p,null,y(C(f),(k,B)=>(t(),l("div",{class:"input-group my-1",key:k.key},[m(z,{name:`files[${B}].file`},null,8,["name"]),m(P,{name:`files[${B}].comment`,id:"floatingTextarea",placeholder:"註解"},null,8,["name"])]))),128)),e("div",se,[e("div",ae,[C(f).length>1?(t(),L(K,{key:0,onClick:i[0]||(i[0]=Z(k=>C(r)(C(f).length-1),["prevent"]))})):T("",!0)]),e("div",ue,[m(O,{onClick:i[1]||(i[1]=Z(k=>C(d)({}),["prevent"]))})]),e("div",de,[e("button",{class:"btn btn-primary",onClick:i[2]||(i[2]=(...k)=>C(b)&&C(b)(...k))},"上傳")])])])]),_:1})],64)}}}),ce={class:"table-responsive"},re={class:"table table-bordered"},pe={class:"table-dark"},me=e("td",null,"Number",-1),_e=e("td",null,"Service Item",-1),ve=e("td",null,"Applied Amount",-1),he=e("td",null,"Comment",-1),be=e("td",null,"實驗人員",-1),Ce=e("td",null,"Received Sample Amount",-1),ye=e("td",null,"Received Comment",-1),ge=e("td",null,"Completed Amount",-1),ke=e("td",null,"Completed Comment",-1),Ae={class:"text-end"},$e=E({__name:"WaitingToCompleteEditZone",props:{items:{}},setup(w){const h=w,A=V(),a=U.getInstance(),{handleSubmit:g}=N({validationSchema:q,initialValues:{waitingToCompleteItems:h.items}}),{fields:s,update:_}=M("waitingToCompleteItems"),$=g(async d=>{const r=d.waitingToCompleteItems.filter(u=>u.completed);r.length&&await a.completeExpServiceItems(r).then(()=>{A.reload()})}),f=d=>{const r=d.target.checked;s.value.forEach((u,b)=>{u.value.completed=r,_(b,u.value)})};return(d,r)=>{const u=v("AppLabelInput"),b=v("AppInput"),x=v("AppCheckbox");return t(),l(p,null,[e("div",ce,[e("table",re,[e("thead",pe,[e("tr",null,[me,_e,ve,he,be,Ce,ye,ge,ke,e("td",null,[e("input",{type:"checkbox",id:"selectAll",onChange:f},null,32)])])]),e("tbody",null,[(t(!0),l(p,null,y(C(s),(o,i)=>(t(),l("tr",{key:o.value.code},[e("td",null,n(o.value.code),1),e("td",null,n(o.value.name),1),e("td",null,[(t(!0),l(p,null,y(o.value.units,c=>(t(),l("div",{key:c.id},n(c.amount)+" "+n(c.name),1))),128))]),e("td",null,n(o.value.comment),1),e("td",null,n(o.value.experimenter),1),e("td",null,[(t(!0),l(p,null,y(o.value.receivedUnits,(c,I)=>(t(),l("div",{key:c.id},[e("span",{class:D({"text-danger":o.value.units[I].amount>c.amount})},n(c.amount)+" "+n(c.name),3)]))),128))]),e("td",null,[e("span",null,n(d.items[i].receivedComment),1)]),e("td",null,[(t(!0),l(p,null,y(o.value.completedUnits,(c,I)=>(t(),l("div",{key:c.id},[m(u,{postfixLabel:c.name,name:`waitingToCompleteItems[${i}].completedUnits[${I}].amount`,type:"number"},null,8,["postfixLabel","name"])]))),128))]),e("td",null,[m(b,{name:`waitingToCompleteItems[${i}].completedComment`},null,8,["name"])]),e("td",null,[d.items[i].completed?T("",!0):(t(),L(x,{key:0,id:`completed[${i}]`,name:`waitingToCompleteItems[${i}].completed`,"checked-value":!0},null,8,["id","name"]))])]))),128))])])]),e("div",Ae,[e("button",{class:"btn btn-primary",onClick:r[0]||(r[0]=(...o)=>C($)&&C($)(...o))},"完成")])],64)}}}),Se={class:"table-responsive"},fe={class:"table table-bordered"},we={class:"table-dark"},xe=e("td",null,"Number",-1),Ie=e("td",null,"Service Item",-1),Te=e("td",null,"Applied Amount",-1),Fe=e("td",null,"Comment",-1),Le=e("td",null,"實驗人員",-1),Ee=e("td",null,"Received Sample Amount",-1),Be=e("td",null,"Received Comment",-1),Re={class:"text-end"},Ue=E({__name:"WaitingToStartEditZone",props:{items:{}},setup(w){const h=w,A=V(),a=U.getInstance(),{handleSubmit:g}=N({validationSchema:G,initialValues:{waitingToStartItems:h.items}}),{fields:s,update:_}=M("waitingToStartItems"),$=g(async d=>{const r=d.waitingToStartItems.filter(u=>u.started);r.length&&await a.startExpServiceItems(r).then(()=>{A.reload()})}),f=d=>{const r=d.target.checked;s.value.forEach((u,b)=>{u.value.started=r,_(b,u.value)})};return(d,r)=>{const u=v("AppLabelInput"),b=v("AppInput"),x=v("AppCheckbox");return t(),l(p,null,[e("div",Se,[e("table",fe,[e("thead",we,[e("tr",null,[xe,Ie,Te,Fe,Le,Ee,Be,e("td",null,[e("input",{type:"checkbox",id:"selectAll",onChange:f},null,32)])])]),e("tbody",null,[(t(!0),l(p,null,y(C(s),(o,i)=>(t(),l("tr",{key:o.value.code},[e("td",null,n(o.value.code),1),e("td",null,n(o.value.name),1),e("td",null,[(t(!0),l(p,null,y(o.value.units,c=>(t(),l("div",{key:c.id},n(c.amount)+" "+n(c.name),1))),128))]),e("td",null,n(o.value.comment),1),e("td",null,n(o.value.experimenter),1),e("td",null,[(t(!0),l(p,null,y(o.value.receivedUnits,(c,I)=>(t(),l("div",{key:c.id},[m(u,{postfixLabel:c.name,name:`waitingToStartItems[${i}].receivedUnits[${I}].amount`,type:"number"},null,8,["postfixLabel","name"])]))),128))]),e("td",null,[m(b,{name:`waitingToStartItems[${i}].receivedComment`},null,8,["name"])]),e("td",null,[m(x,{id:`start[${i}]`,name:`waitingToStartItems[${i}].started`,"checked-value":!0},null,8,["id","name"])])]))),128))])])]),e("div",Re,[e("button",{class:"btn btn-primary",onClick:r[0]||(r[0]=(...o)=>C($)&&C($)(...o))},"開始")])],64)}}}),De={class:"mb-2 d-flex justify-content-between flex-row-reverse mt-4"},Ze=E({__name:"ManageExpServiceItem",props:{id:{}},async setup(w){let h,A;const a=w,g=U.getInstance(),s=R([]),_=R([]),$=R([]);[h,A]=j(()=>g.fetchManageExpCaseItemInitData(a.id).then(d=>{s.value=d.waitingToStartList,_.value=d.waitingToCompleteList,$.value=d.completedList}).catch(d=>{console.error(d)})),await h,A();const f=async()=>{await g.finishManageExpServiceItem(a.id).then(()=>{})};return(d,r)=>{var b,x,o;const u=v("AppCard");return t(),l(p,null,[(b=s.value)!=null&&b.length?(t(),L(u,{key:0,class:"my-1"},{header:S(()=>[F(" Waiting to Start ")]),body:S(()=>[m(Ue,{items:s.value},null,8,["items"])]),_:1})):T("",!0),(x=_.value)!=null&&x.length?(t(),L(u,{key:1,class:"my-1"},{header:S(()=>[F(" Waiting to Complete ")]),body:S(()=>[m($e,{items:_.value},null,8,["items"])]),_:1})):T("",!0),(o=$.value)!=null&&o.length?(t(),L(u,{key:2,class:"my-1"},{header:S(()=>[F(" Completed ")]),body:S(()=>[m(Y,{items:$.value},null,8,["items"])]),_:1})):T("",!0),m(u,{class:"my-1"},{header:S(()=>[F(" Upload Result File(s) ")]),body:S(()=>[m(ie,{id:d.id},null,8,["id"])]),_:1}),e("div",De,[e("div",null,[s.value.length==0&&_.value.length==0?(t(),l("button",{key:0,class:"btn btn-primary",onClick:f}," 完成 ")):T("",!0)])])],64)}}});export{Ze as default};
