import{U as W}from"./UserService-be113d4f.js";import{d as X,r as b,O as Y,S as Z,A as q,T as Q,J as $,U as ee,e as te,V as se,B as ae,g as ne,W as oe,h as C,o,c as p,j as r,a as e,t as _,H as P,w as c,n as D,l,G as re,X as y,D as V,F as g,C as I,Y as le,p as ce,Z as ie,$ as me}from"./index-b61f44e7.js";import{T as ue,A as pe}from"./formSchema-20d4a25b.js";import"./ProjectChargeType-415a59f1.js";var T=(s=>(s.NA="NA",s.STAGE_1="STAGE1",s.STAGE_2="STAGE2",s.STAGE_3="STAGE3",s.STAGE_4="STAGE4",s.STAGE_5="STAGE5",s.STAGE_6="STAGE6",s))(T||{});const L=T;(s=>{function d(){return["NA","STAGE1","STAGE2","STAGE3","STAGE4","STAGE5","STAGE6"]}s.getDrugScreenings=d;function S(n){switch(n){case"NA":return"不適用";case"STAGE1":return"stage 1. 篩選、鑑定及確認:生物標的、分子標靶新藥、新生醫材料、新檢測試劑";case"STAGE2":return"stage 2. 潛力標的物之合成及改良:新醫材/試劑之設計/改良";case"STAGE3":return"stage 3. 臨床檢體驗證、細胞及動物有效性評估";case"STAGE4":return"stage 4. 先導藥品及醫材之最適化; 新醫材/試劑產品雛型之開發及試製造";case"STAGE5":return"stage 5. 藥理藥動改良;劑型設計;毒理安全性試驗";case"STAGE6":return"stage 6. 試驗用藥物: 新醫材/試劑之申請";default:return""}}s.getChineseDescription=S;function B(n){switch(n){case"NA":return"不適用";case"STAGE1":return"stage 1. Identification & confirmation of biomarkers, new targets, drugs, bio-medical devices.";case"STAGE2":return"stage 2. Synthesis & improvement of targets. Design & modification of new medical devices.";case"STAGE3":return"stage 3. Validation with clinical samples. In vitro & in vivo efficacy evaluation.";case"STAGE4":return"stage 4. Optimization of leads & device models-Prototype development- Pilot-scale manufacturing.";case"STAGE5":return"stage 5. Improvement of PK, PD, & formulation- Animal toxicity and safety tests.";case"STAGE6":return"stage 6. IND/IDE applications.";default:return""}}s.getEnglishDescription=B})(T||(T={}));const de={class:"fw-bold py-3 mb-4"},_e={class:"row mb-3"},he=e("label",{for:"expDateStart",class:"col-sm-2 col-md-3 col-form-label red-star"},"已安排之實驗日期區間",-1),fe={class:"col-8"},Se={class:"d-flex flow-row gap-1"},ve={class:"row mb-3"},be=e("label",{for:"liaison",class:"col-sm-2 col-md-3 col-form-label red-star"},"TAC聯絡窗口/SD",-1),ye={class:"col-8"},ge=e("h5",{class:"mb-0"},"已選擇服務項目",-1),Te={class:"table-responsive"},Ae={class:"table table-striped"},Ee=e("thead",null,[e("tr",null,[e("th",null,"Number"),e("th",null,"Service item"),e("th",null,"Note"),e("th",null,"Sample amount"),e("th",null,"Comment")])],-1),Ge={class:"input-group mb-3"},xe=e("h5",{class:"mb-0 red-star"},"Survey for Drug Screening",-1),ke=e("span",{class:"fw-light"}," Is this experiment related to drug screening or development?",-1),we=e("h5",{class:"mb-0 red-star"},"Points for Attention",-1),Ce=e("ol",null,[e("li",null,[e("a",{class:"link-primary",href:"https://tmc.sinica.edu.tw/sampleprep_c.html",target:"_blank"},"血液、血清、組織及尿液/Blood, Serum, Tissue and Urine")]),e("li",null,[e("a",{class:"link-primary",href:"https://tmc.sinica.edu.tw/slide_c.html",target:"_blank"},"玻片掃描/Slide Scanning")]),e("li",null,[e("a",{class:"link-primary",href:"https://tmc.sinica.edu.tw/femur_c.html",target:"_blank"},"股骨製備/Femur Preparation")]),e("li",null,[e("a",{class:"link-primary",href:" https://tmc.sinica.edu.tw/animal_checkin_c_01.html",target:"_blank"},"動物房/Mouse Hotel ")])],-1),De={class:"form-check form-check-inline"},Ie={class:"form-check-label",for:"terms"},Be=e("div",{class:"mb-2 d-flex justify-content-between flex-row-reverse"},[e("button",{class:"btn btn-primary"},"確定申請")],-1),Pe=X({__name:"ExpApplicationStep1",props:{labType:{}},async setup(s){let d,S;const n=b(s.labType),R=ce(),h=Y(),j=Z(),M=q(),z=W.getInstance();Q(j);const i=b({items:[],labType:n.value}),A=()=>n.value==="TMC"?ue:pe,E=b(A());$(()=>{console.log("onBeforeMount"),i.value=h.getCartByLabType(n.value),E.value=A()}),ee((t,f)=>{console.log("onBeforeRouteUpdate"),n.value=t.params.labType,i.value=h.getCartByLabType(n.value),E.value=A()});const H=i.value.items.map(t=>({code:t.code,name:t.name,note:t.note,expServiceItemUnits:t.expServiceItemUnits})),{errors:G,handleSubmit:O}=te({initialValues:{expServiceItems:H}}),{fields:J}=se("expServiceItems"),v=b(""),K=([d,S]=ae(()=>z.fetchExpTeamMembers(i.value.labType).catch(t=>(v.value=t.message,[]))),d=await d,S(),d).map(t=>({id:t.id,name:t.title,value:t.id.toString()})),N=ne(()=>n.value==="TMC"),U=O((t,f)=>{try{E.value.validateSync(t,{abortEarly:!1}),M.processStep1(i.value.labType,t,"1").then(async m=>{try{h.reset(i.value.labType),await M.proceedToStep2(m)}catch(u){v.value=u.message}}).catch(m=>{v.value=m.message})}catch(m){m.inner.map(u=>{let x={[u.path]:u.message};f.setErrors(x)})}}),F=()=>{R.push("/main")};return $(()=>{h.isEmpty&&F()}),oe(()=>{h.isEmpty&&F()}),(t,f)=>{const m=C("AppFloatingMessage"),u=C("AppInputGroup"),x=C("AppSelect");return o(),p(g,null,[r(m,{message:v.value},null,8,["message"]),e("form",{onSubmit:f[0]||(f[0]=(...a)=>l(U)&&l(U)(...a))},[e("h4",de,_(i.value.labType)+"服務項目",1),N.value?(o(),P(y,{key:0,class:"mb-2"},{body:c(()=>[e("div",_e,[he,e("div",fe,[e("div",Se,[r(u,{label:"起",id:"expDateStart",type:"date",format:"yyyy-mm-dd",name:"expDateStart",class:D(l(G).expDateStart?"form-control is-invalid":"form-control")},null,8,["class"]),re("~ "),r(u,{label:"迄",id:"expDateEnd",type:"date",format:"yyyy-mm-dd",name:"expDateEnd",class:D(l(G).expDateEnd?"form-control is-invalid":"form-control")},null,8,["class"])])])]),e("div",ve,[be,e("div",ye,[r(x,{id:"liaison",name:"liaison",options:l(K),"default-option":!0},null,8,["options"])])])]),_:1})):V("",!0),r(y,{class:"mb-2"},{header:c(()=>[ge]),body:c(()=>[e("div",Te,[e("table",Ae,[Ee,e("tbody",null,[(o(!0),p(g,null,I(l(J),(a,k)=>(o(),p("tr",{key:a.key},[e("td",null,_(a.value.code),1),e("td",null,_(a.value.name),1),e("td",null,_(a.value.note),1),e("td",null,[(o(!0),p(g,null,I(a.value.expServiceItemUnits,w=>(o(),p("div",{key:w.index},[e("div",Ge,_(w.amount)+" "+_(w.name),1)]))),128))]),e("td",null,[r(ie,{name:`expServiceItems[${k}].comment`},null,8,["name"])])]))),128))])])])]),_:1}),r(y,{class:"mb-2"},{header:c(()=>[xe]),title:c(()=>[ke]),body:c(()=>[(o(!0),p(g,null,I(l(L).getDrugScreenings(),(a,k)=>(o(),p("div",{class:"form-check my-3",key:a},[r(me,{id:`stage${k}`,name:"drugScreening",label:l(L).getChineseDescription(a),"checked-value":a},null,8,["id","label","checked-value"])]))),128))]),_:1}),N.value?(o(),P(y,{key:1,class:"mb-2"},{header:c(()=>[we]),body:c(()=>[e("div",null,[Ce,e("div",De,[r(le,{id:"terms",name:"terms","checked-value":"agree"}),e("label",Ie,[e("span",{class:D(l(G).terms?"text-danger":"")}," 我已詳細閱讀注意事項 (I have read the notes for applicants)",2)])])])]),_:1})):V("",!0),Be],32)],64)}}});export{Pe as default};
