import{T as X,A as Y}from"./formSchema-ea7f1a00.js";import{d as Z,r as f,H as ee,D as te,E as P,N as ae,e as se,O as ne,s as oe,g as re,P as le,h as u,o as r,c as d,j as l,a as e,t as v,B as V,w as i,n as I,l as c,A as ce,z as L,F as A,y as D,p as ie,K as me}from"./index-8fed8339.js";import{U as pe}from"./UserService-edbe053c.js";import"./ProjectChargeType-415a59f1.js";var T=(a=>(a.NA="NA",a.STAGE_1="STAGE1",a.STAGE_2="STAGE2",a.STAGE_3="STAGE3",a.STAGE_4="STAGE4",a.STAGE_5="STAGE5",a.STAGE_6="STAGE6",a))(T||{});const R=T;(a=>{function h(){return["NA","STAGE1","STAGE2","STAGE3","STAGE4","STAGE5","STAGE6"]}a.getDrugScreenings=h;function b(s){switch(s){case"NA":return"不適用";case"STAGE1":return"stage 1. 篩選、鑑定及確認:生物標的、分子標靶新藥、新生醫材料、新檢測試劑";case"STAGE2":return"stage 2. 潛力標的物之合成及改良:新醫材/試劑之設計/改良";case"STAGE3":return"stage 3. 臨床檢體驗證、細胞及動物有效性評估";case"STAGE4":return"stage 4. 先導藥品及醫材之最適化; 新醫材/試劑產品雛型之開發及試製造";case"STAGE5":return"stage 5. 藥理藥動改良;劑型設計;毒理安全性試驗";case"STAGE6":return"stage 6. 試驗用藥物: 新醫材/試劑之申請";default:return""}}a.getChineseDescription=b;function N(s){switch(s){case"NA":return"不適用";case"STAGE1":return"stage 1. Identification & confirmation of biomarkers, new targets, drugs, bio-medical devices.";case"STAGE2":return"stage 2. Synthesis & improvement of targets. Design & modification of new medical devices.";case"STAGE3":return"stage 3. Validation with clinical samples. In vitro & in vivo efficacy evaluation.";case"STAGE4":return"stage 4. Optimization of leads & device models-Prototype development- Pilot-scale manufacturing.";case"STAGE5":return"stage 5. Improvement of PK, PD, & formulation- Animal toxicity and safety tests.";case"STAGE6":return"stage 6. IND/IDE applications.";default:return""}}a.getEnglishDescription=N})(T||(T={}));const ue={class:"fw-bold py-3 mb-4"},de={class:"row mb-3"},he=e("label",{for:"expDateStart",class:"col-sm-2 col-md-3 col-form-label red-star"},"已安排之實驗日期區間",-1),_e={class:"col-8"},ve={class:"d-flex flow-row gap-1"},Se={class:"row mb-3"},fe=e("label",{for:"liaison",class:"col-sm-2 col-md-3 col-form-label red-star"},"TAC聯絡窗口/SD",-1),be={class:"col-8"},ye=e("h5",{class:"mb-0"},"已選擇服務項目",-1),ge={class:"table-responsive"},Ae={class:"table table-striped"},Te=e("thead",null,[e("tr",null,[e("th",null,"Number"),e("th",null,"Service item"),e("th",null,"Note"),e("th",null,"Sample amount"),e("th",null,"Comment")])],-1),Ee={class:"input-group mb-3"},xe=e("h5",{class:"mb-0 red-star"},"Survey for Drug Screening",-1),Ge=e("span",{class:"fw-light"}," Is this experiment related to drug screening or development?",-1),ke=e("h5",{class:"mb-0 red-star"},"Points for Attention",-1),Ce=e("ol",null,[e("li",null,[e("a",{class:"link-primary",href:"https://tmc.sinica.edu.tw/sampleprep_c.html",target:"_blank"},"血液、血清、組織及尿液/Blood, Serum, Tissue and Urine")]),e("li",null,[e("a",{class:"link-primary",href:"https://tmc.sinica.edu.tw/slide_c.html",target:"_blank"},"玻片掃描/Slide Scanning")]),e("li",null,[e("a",{class:"link-primary",href:"https://tmc.sinica.edu.tw/femur_c.html",target:"_blank"},"股骨製備/Femur Preparation")]),e("li",null,[e("a",{class:"link-primary",href:" https://tmc.sinica.edu.tw/animal_checkin_c_01.html",target:"_blank"},"動物房/Mouse Hotel ")])],-1),we={class:"form-check form-check-inline"},Ie={class:"form-check-label",for:"terms"},De=e("div",{class:"mb-2 d-flex justify-content-between flex-row-reverse"},[e("button",{class:"btn btn-primary"},"確定申請")],-1),Pe=Z({__name:"ExpApplicationStep1",props:{labType:{}},async setup(a){let h,b;const s=f(a.labType),j=ie(),_=ee(),z=te(),$=pe.getInstance(),H=me.getInstance(),o=f({items:[],labType:s.value}),E=()=>s.value==="TMC"?X:Y,x=f(E());o.value=_.getCartByLabType(s.value);const B=f(o.value.items.map(t=>({code:t.code,name:t.name,note:t.note,expServiceItemUnits:t.expServiceItemUnits})));P(()=>{o.value=_.getCartByLabType(s.value),x.value=E(),B.value=o.value.items.map(t=>({code:t.code,name:t.name,note:t.note,expServiceItemUnits:t.expServiceItemUnits}))}),ae((t,S)=>{s.value=t.params.labType,o.value=_.getCartByLabType(s.value),x.value=E()});const{errors:G,handleSubmit:K}=se({initialValues:{expServiceItems:B.value}}),{fields:O}=ne("expServiceItems"),y=f(""),q=([h,b]=oe(()=>$.fetchExpTeamMembers(o.value.labType).catch(t=>(y.value=t.message,[]))),h=await h,b(),h).map(t=>({id:t.id,name:t.title,value:t.id.toString()})),M=re(()=>s.value==="TMC"),U=K(async(t,S)=>{try{x.value.validateSync(t,{abortEarly:!1}),await H.createExpCase(o.value.labType,t).then(async m=>{try{_.reset(o.value.labType),await z.proceedToStep2(m)}catch(p){y.value=p.message}}).catch(m=>{y.value=m.message})}catch(m){m.inner.map(p=>{let k={[p.path]:p.message};S.setErrors(k)})}}),F=()=>{j.push("/main")};return P(()=>{_.isEmpty&&F()}),le(()=>{_.isEmpty&&F()}),(t,S)=>{const m=u("AppFloatingMessage"),p=u("AppInputGroup"),k=u("AppSelect"),g=u("AppCard"),J=u("AppInput"),Q=u("AppRadio"),W=u("AppCheckbox");return r(),d(A,null,[l(m,{message:y.value},null,8,["message"]),e("form",{onSubmit:S[0]||(S[0]=(...n)=>c(U)&&c(U)(...n))},[e("h4",ue,v(o.value.labType)+"服務項目",1),M.value?(r(),V(g,{key:0,class:"mb-2"},{body:i(()=>[e("div",de,[he,e("div",_e,[e("div",ve,[l(p,{label:"起",id:"expDateStart",type:"date",format:"yyyy-mm-dd",name:"expDateStart",class:I(c(G).expDateStart?"form-control is-invalid":"form-control")},null,8,["class"]),ce("~ "),l(p,{label:"迄",id:"expDateEnd",type:"date",format:"yyyy-mm-dd",name:"expDateEnd",class:I(c(G).expDateEnd?"form-control is-invalid":"form-control")},null,8,["class"])])])]),e("div",Se,[fe,e("div",be,[l(k,{id:"liaison",name:"liaison",options:c(q),"default-option":!0},null,8,["options"])])])]),_:1})):L("",!0),l(g,{class:"mb-2"},{header:i(()=>[ye]),body:i(()=>[e("div",ge,[e("table",Ae,[Te,e("tbody",null,[(r(!0),d(A,null,D(c(O),(n,C)=>(r(),d("tr",{key:n.key},[e("td",null,v(n.value.code),1),e("td",null,v(n.value.name),1),e("td",null,v(n.value.note),1),e("td",null,[(r(!0),d(A,null,D(n.value.expServiceItemUnits,w=>(r(),d("div",{key:w.index},[e("div",Ee,v(w.amount)+" "+v(w.name),1)]))),128))]),e("td",null,[l(J,{name:`expServiceItems[${C}].comment`},null,8,["name"])])]))),128))])])])]),_:1}),l(g,{class:"mb-2"},{header:i(()=>[xe]),title:i(()=>[Ge]),body:i(()=>[(r(!0),d(A,null,D(c(R).getDrugScreenings(),(n,C)=>(r(),d("div",{class:"form-check my-3",key:n},[l(Q,{id:`stage${C}`,name:"drugScreening",label:c(R).getChineseDescription(n),"checked-value":n},null,8,["id","label","checked-value"])]))),128))]),_:1}),M.value?(r(),V(g,{key:1,class:"mb-2"},{header:i(()=>[ke]),body:i(()=>[e("div",null,[Ce,e("div",we,[l(W,{id:"terms",name:"terms","checked-value":"agree"}),e("label",Ie,[e("span",{class:I(c(G).terms?"text-danger":"")}," 我已詳細閱讀注意事項 (I have read the notes for applicants)",2)])])])]),_:1})):L("",!0),De],32)],64)}}});export{Pe as default};
