import{d as T,f as ae,h as I,o as r,i as p,j as e,F as A,z as O,t as l,A as S,k as u,w as v,B as C,m as n,Q as oe,R as se,S as ne,s as H,J as ie,x as M,r as N,c as le,T as re,q as R,H as ce,l as k,v as x,C as Q,p as U,U as z,K as me,V as j}from"./index-c3923e02.js";import{l as ue}from"./formSchema-a822dc0e.js";import{g as ve,_ as f,a as pe,S as y,b as q,c as de}from"./NonLivingFormEditingZone.vue_vue_type_script_setup_true_lang-a2234b3a.js";import"./LocationApi-2a0b8f6c.js";const _e={class:"list-group"},be={class:"breadcrumb"},he={class:"breadcrumb-item"},ge={class:"breadcrumb-item"},fe={key:0,class:"breadcrumb-item"},ye={key:1,class:"breadcrumb-item"},Ce={class:"breadcrumb-item"},Fe={class:"breadcrumb-item"},ke=T({inheritAttrs:!1,__name:"LivingFormCompleted",props:{livingForm:{}},setup($){const d=$,s=ae(()=>ne(d.livingForm.iacucProtocol));return(t,L)=>{const b=I("AppDownloadLink");return r(),p("div",oe(se(t.$attrs)),[e("ul",_e,[(r(!0),p(A,null,O(t.livingForm.deliveries,(a,h)=>(r(),p("li",{class:"list-group-item bg-info mb-1",key:h},[e("ol",be,[e("li",he," 品系: "+l(a.strain==="ratOther"?a.ratOtherStrain:a.strain==="miceOther"?a.miceOtherStrain:a.strain),1),e("li",ge,"週齡: "+l(a.age),1),a.maleQty?(r(),p("li",fe,"公: "+l(a.maleQty||0),1)):S("",!0),a.femaleQty?(r(),p("li",ye,"母: "+l(a.femaleQty||0),1)):S("",!0),e("li",Ce,"送來的籠數: "+l(a.sendingCagesQty),1),e("li",Fe,"實驗籠數: "+l(a.expCage),1)])]))),128))]),u(f,{label:"物種"},{content:v(()=>[C(l(n(ve)(t.livingForm.animalType)),1)]),_:1}),u(f,{label:"預計運送動物日期"},{content:v(()=>[C(l(t.livingForm.animalArrivalDate),1)]),_:1}),u(f,{label:"預計運送動物時間"},{content:v(()=>[C(l(t.livingForm.animalArrivalTime==="morning"?"上午9:00~12:00":"下午13:30~16:30"),1)]),_:1}),u(f,{label:"IACUC Number"},{content:v(()=>[C(l(t.livingForm.iacucNo),1)]),_:1}),u(f,{label:"IACUC Protocol"},{content:v(()=>[u(b,{name:s.value.name,value:s.value.value},null,8,["name","value"])]),_:1}),u(f,{label:"Note"},{content:v(()=>[C(l(t.livingForm.note),1)]),_:1})],16)}}}),Se={class:"mt-4"},$e=e("h5",{class:"mb-0"},"填寫入室資料",-1),Le={class:"row mb-3"},we=e("label",{for:"iacucfile",class:"col-sm-2 col-form-label"},"選擇表單來源",-1),Ne={class:"col-8 mb-3"},Ie={class:"input-group"},Ae={class:"d-flex flex-row-reverse mt-2"},Ve={class:"nav nav-tabs",id:"myTab",role:"tablist"},xe=["id","data-bs-target","aria-controls"],Oe={class:"tab-content"},Qe=["id","aria-labelledby","tabindex"],Te={class:"mt-2 d-flex flex-row-reverse"},De=["onClick"],Ee=["onClick"],Pe={class:"mb-2 d-flex justify-content-between flex-row-reverse mt-2"},Be=T({__name:"LivingFormEditingZone",emits:["saveLivingForm"],async setup($,{emit:d}){let s,t;const L=d,b=H(),{showMedicationInfoFrom:a,showCellLineInfoFrom:h}=ie(b),V=([s,t]=M(()=>b.fetchFormSourceOptions()),s=await s,t(),s),i=N([]);[s,t]=M(()=>b.fetchLivingForms().then(o=>{o&&(i.value=o)})),await s,t();const g=N(!1),F=N(-1),{handleSubmit:D,values:E,resetForm:J,errors:K}=le({initialValues:{deliveries:[{strain:"",ratOtherStrain:"",miceStrainOther:"",special:"",specialExplain:"",age:"",maleQty:0,femaleQty:0,sendingCagesQty:0,expCage:0}],showMedicationInfoFrom:a.value,showCellLineInfoFrom:h.value},validationSchema:ue});re("errors",K);function w(o={deliveries:[{strain:"",ratOtherStrain:"",miceStrainOther:"",special:"",specialExplain:"",age:"",maleQty:0,femaleQty:0,sendingCagesQty:0,expCage:0}]}){J({values:o},{force:!0})}const P=D(async o=>{const c=R.cloneDeep(o);c.id=ce(),i.value.push(c),w()}),B=D(async o=>{const c=R.cloneDeep(o);w(),i.value[F.value]=c,F.value=-1,g.value=!1}),Z=o=>{g.value=!0,F.value=o;const c=i.value[o];w(c),window.scrollTo({top:100,behavior:"smooth"})},W=o=>{g.value=!1,F.value=o,i.value.splice(o,1)},X=()=>{L("saveLivingForm",i.value)};function Y(){F.value=-1,g.value=!1;const o=b.fetchLivingForm(E.formSource);w(o)}return(o,c)=>{const ee=I("AppSelect"),G=I("AppCard");return r(),p("form",Se,[u(G,{class:"mt-4"},{header:v(()=>[$e]),body:v(()=>[e("div",Le,[we,e("div",Ne,[e("div",Ie,[u(ee,{name:"formSource",options:n(V),onChange:c[0]||(c[0]=_=>Y()),"default-option":!1,value:"new"},null,8,["options"])])]),u(pe,{values:n(E)},null,8,["values"]),e("div",Ae,[k(e("button",{class:"btn btn-primary",type:"button",onClick:c[1]||(c[1]=(..._)=>n(B)&&n(B)(..._))}," 修改 ",512),[[x,g.value]]),k(e("button",{class:"btn btn-info text-white",type:"button",onClick:c[2]||(c[2]=(..._)=>n(P)&&n(P)(..._))}," 填寫完畢 ",512),[[x,!g.value]])])])]),_:1}),i.value.length?(r(),Q(G,{key:0,class:"mt-2"},{title:v(()=>[C(" 已填寫入室申請表 ")]),body:v(()=>[e("ul",Ve,[(r(!0),p(A,null,O(i.value,(_,m)=>(r(),p("li",{class:"nav-item",role:"presentation",key:_.id},[e("button",{class:U(["nav-link",{active:m===0}]),id:`homeTab${m}`,"data-bs-toggle":"tab","data-bs-target":`#tabPanel${m}`,type:"button",role:"tab","aria-controls":`tabPanel${m}`,"aria-selected":"true"}," #"+l(m+1),11,xe)]))),128))]),e("div",Oe,[(r(!0),p(A,null,O(i.value,(_,m)=>(r(),p("div",{class:U(["tab-pane p-2",{active:m===0}]),id:`tabPanel${m}`,role:"tabpanel","aria-labelledby":`homeTab${m}`,tabindex:m,key:_.id},[u(ke,{livingForm:_},null,8,["livingForm"]),e("div",Te,[e("button",{type:"button",class:"btn btn-secondary",onClick:z(te=>Z(m),["prevent"])}," 編輯 ",8,De),e("button",{type:"button",class:"btn btn-danger mx-1",onClick:z(te=>W(m),["prevent"])}," 刪除 ",8,Ee)])],10,Qe))),128))])]),_:1})):S("",!0),e("div",Pe,[k(e("button",{type:"button",class:"btn btn-primary",onClick:X}," 下一步 ",512),[[x,i.value.length]])])])}}}),Ge=e("h4",{class:"fw-bold py-3 mb-4"},"實驗類型",-1),Me=e("h5",{class:"mb-0"},"活體/非活體",-1),Re={class:"form-check form-check-inline"},Ue=["value"],ze={class:"form-check-label",for:"living"},je={class:"form-check form-check-inline"},qe=["value"],He={class:"form-check-label",for:"nonLiving"},Xe=T({__name:"ExpApplicationStep2",props:{id:{}},setup($){const d=$,s=H(),t=N(s.expCase.sampleCategory),L=async a=>{await s.saveLivingForms(d.id,t.value,a).then(()=>{s.proceedToStep3(d.id)})},b=async a=>{await s.saveNonLivingForm(d.id,t.value,a).then(()=>{s.proceedToStep3(d.id)})};return me(async()=>{await s.loadExpCaseById(d.id)}),(a,h)=>{const V=I("AppCard");return r(),p(A,null,[Ge,u(V,null,{header:v(()=>[Me]),body:v(()=>[e("div",Re,[k(e("input",{name:"sampleCategory",class:"form-check-input",type:"radio",value:n(y).LIVING,id:"living","onUpdate:modelValue":h[0]||(h[0]=i=>t.value=i)},null,8,Ue),[[j,t.value]]),e("label",ze,l(n(q)(n(y).LIVING)),1)]),e("div",je,[k(e("input",{name:"sampleCategory",class:"form-check-input",type:"radio",value:n(y).NON_LIVING,id:"nonLiving","onUpdate:modelValue":h[1]||(h[1]=i=>t.value=i)},null,8,qe),[[j,t.value]]),e("label",He,l(n(q)(n(y).NON_LIVING)),1)])]),_:1}),t.value===n(y).LIVING?(r(),Q(Be,{key:0,onSaveLivingForm:L})):S("",!0),t.value===n(y).NON_LIVING?(r(),Q(de,{key:1,onSaveNonLivingForm:b})):S("",!0)],64)}}});export{Xe as default};
