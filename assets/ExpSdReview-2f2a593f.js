import{d as O,D as P,r as b,s as j,e as G,h as c,o as l,c as m,j as t,w as u,a as e,t as d,B as S,z as y,F as x,y as V,l as n,A as U,K as z}from"./index-8fed8339.js";import{a as q,S as s}from"./ExpCaseFormSchema-d7aa9de3.js";import{_ as H}from"./ExpApplicationStep6LivingFormPreview.vue_vue_type_script_setup_true_lang-bb676fd7.js";import{_ as J}from"./ExpApplicationStep6NonLivingFormPreview.vue_vue_type_script_setup_true_lang-30523d45.js";import"./formSchema-ea7f1a00.js";import"./LivingFormPreview.vue_vue_type_script_setup_true_lang-4b40567c.js";import"./AnimalType-4489de17.js";import"./SelectedIhcCommissionedItemPanel-70429422.js";import"./LocationService-438c0953.js";import"./LocationDbSimulator-1334c689.js";const Q=e("h4",{class:"fw-bold py-3 mb-4"},"審查實驗申請",-1),W={class:"my-1"},X={class:"my-1"},Y=e("h5",null,"修改日期/服務項目",-1),Z={key:0,id:"nonLivingFormSection"},ee={key:1,id:"livingFormSection",class:"mb-4"},te={class:"input-group flex-nowrap"},ne=e("span",{class:"input-group-text",id:"預計運送動物日期"},"預計運送動物時間",-1),ae={class:"form-control"},le={id:"expServiceItemSection",class:"my-2"},oe={class:"table"},se=e("thead",{class:"table-dark"},[e("tr",null,[e("th",null,"Number"),e("th",null,"Service Item"),e("th",null,"總數"),e("th",null,"備註"),e("th",null,"實驗人員")])],-1),ie={id:"section3"},re={class:"mb-2 d-flex justify-content-between flex-row-reverse mt-2"},xe=O({__name:"ExpSdReview",props:{id:{}},async setup(D){let f,g;const k=D,T=P(),A=z.getInstance(),E=b([]),F=b([]),a=b({}),v=b({});[f,g]=j(()=>A.fetchDataForSdReview(k.id).then(i=>{a.value=i[0],v.value=i[1],v.value.expTeamMembers.map(o=>{E.value.push({label:o.title,value:o.id})}),v.value.liaisons.map(o=>{F.value.push({id:o.id.toString(),name:o.title,value:o.id.toString()})})}).catch(i=>{console.error(i)})),await f,g();const{handleSubmit:L,values:_,errors:ce}=G({initialValues:v.value,validationSchema:q}),I=L(async i=>{A.completeSdReview(k.id,i,a.value.livingForms,a.value.nonLivingForm).then(async()=>{await T.toMain()})});return(i,o)=>{const h=c("AppCard"),R=c("AppLabelInput"),p=c("AppRadio"),B=c("AppInputGroup"),M=c("AppSelect2"),N=c("AppSelect"),$=c("AppTextarea");return l(),m(x,null,[Q,t(h,{class:"my-1"},{body:u(()=>[e("div",W,"已安排之實驗日期區間: "+d(a.value.period),1),e("div",X,"聯絡窗口/SD: "+d(a.value.liaison),1)]),_:1}),t(h,null,{header:u(()=>[e("h5",null,d(a.value.livingForms?"活體入室申請表":"非活體入室申請表"),1)]),body:u(()=>[a.value.livingForms?(l(),S(H,{key:0,livingForms:a.value.livingForms},null,8,["livingForms"])):(l(),S(J,{key:1,form:a.value.nonLivingForm},null,8,["form"]))]),_:1}),t(h,{class:"my-1"},{header:u(()=>[Y]),body:u(()=>[a.value.nonLivingForm?(l(),m("div",Z,[t(R,{name:"scheduledDeliveryDate",label:"約定的送件日期",type:"date"})])):y("",!0),a.value.livingForms?(l(),m("div",ee,[t(R,{name:"arrivalDate",label:"預計運送動物日期",type:"date"}),e("div",te,[ne,e("div",ae,[t(p,{id:"animalArrivalTimeMorning",name:"arrivalTime","checked-value":"morning",label:"上午9:00~12:00"}),t(p,{id:"animalArrivalTimeAfternoon",name:"arrivalTime","checked-value":"afternoon",label:"下午13:30~16:30"})])])])):y("",!0),e("div",le,[e("table",oe,[se,e("tbody",null,[(l(!0),m(x,null,V(n(_).expServiceItems,(r,w)=>(l(),m("tr",{key:r.id},[e("td",null,d(r.code),1),e("td",null,d(r.name),1),e("td",null,[(l(!0),m(x,null,V(r.expServiceItemUnits,(C,K)=>(l(),m("div",{key:C.index},[t(B,{name:`expServiceItems[${w}].expServiceItemUnits[${K}].amount`,label:C.name,type:"number",min:"0"},null,8,["name","label"])]))),128))]),e("td",null,d(r.comment),1),e("td",null,[t(M,{name:`expServiceItems[${w}].expTeamMembers`,options:E.value,multiple:!0},null,8,["name","options"])])]))),128))])])])]),_:1}),t(h,{class:"my-1"},{title:u(()=>[U(" 核查結果 ")]),body:u(()=>[e("div",ie,[t(p,{id:"approve",name:"status","checked-value":n(s).APPROVE,label:"同意"},null,8,["checked-value"]),t(p,{id:"cancel",name:"status","checked-value":n(s).REVOKE,label:"取消"},null,8,["checked-value"]),t(p,{id:"revise",name:"status","checked-value":n(s).REVISE,label:"修改"},null,8,["checked-value"]),t(p,{id:"change",name:"status","checked-value":n(s).REPLACE_SD,label:"更換SD"},null,8,["checked-value"]),[n(s).REPLACE_SD].includes(n(_).status)?(l(),S(N,{key:0,id:"liaison",name:"liaison",options:F.value,"default-option":!0},null,8,["options"])):y("",!0),[n(s).REVOKE,n(s).REVISE].includes(n(_).status)?(l(),S($,{key:1,name:"reason",maxlength:"100",placeholder:n(_).status===n(s).REVOKE?"請填寫取消原因":"請填寫修改建議"},null,8,["placeholder"])):y("",!0)])]),_:1}),e("div",re,[e("button",{type:"button",class:"btn btn-primary",onClick:o[0]||(o[0]=(...r)=>n(I)&&n(I)(...r))},"確定")])],64)}}});export{xe as default};
